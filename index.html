

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Documentation for DFT-D4">
    <meta name="author" content="Grimme group Bonn" >
    <link rel="icon" href="./favicon.png">

    <title> DFT-D4 </title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Font Awesome -->
    <link href="./css/fontawesome.min.css" rel="stylesheet">
    <link href="./css/brands.min.css" rel="stylesheet">
    <link href="./css/regular.min.css" rel="stylesheet">
    <link href="./css/solid.min.css" rel="stylesheet">
    <link href="./css/v4-font-face.min.css" rel="stylesheet">
    <link href="./css/v4-shims.min.css" rel="stylesheet">
    <!-- MathJax -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async
            integrity="sha256-DViIOMYdwlM/axqoGDPeUyf0urLoHMN4QACBKyB58Uw=" crossorigin="anonymous"></script>
    <!-- Other scripts and stylesheets -->
    <link href="./css/local.css" rel="stylesheet">
    <link href="./css/pygments.css" rel="stylesheet">
    <script src="./js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="./index.html">DFT-D4 </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="./lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="./lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="./search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <!-- Main component for a primary marketing message or call to action -->
    <div class="p-5 mb-4 bg-light border rounded-3" id="jumbotron">
      
        <p> Find us on&hellip;</p>
      <p>
        <a class="btn btn-lg btn-primary" href="https://github.com/dftd4/dftd4" role="button">GitHub</a>
        
        
        
        
      </p>
    </div>

      <div class="row" id='text'>
        <div class=col-md-8>
          <h1>DFT-D4</h1>
          <h1 id="dft-d4-project">DFT-D4 project</h1>
<p><a href="https://github.com/dftd4/dftd4/blob/main/COPYING.LESSER"><img alt="License" src="https://img.shields.io/github/license/dftd4/dftd4?cacheSeconds=86400"></a>
<a href="https://github.com/dftd4/dftd4/releases/latest"><img alt="Latest Version" src="https://img.shields.io/github/v/release/dftd4/dftd4"></a>
<a href="https://github.com/dftd4/dftd4/actions"><img alt="Build Status" src="https://github.com/dftd4/dftd4/workflows/CI/badge.svg"></a>
<a href="https://dftd4.readthedocs.io/en/latest/?badge=latest"><img alt="Documentation Status" src="https://readthedocs.org/projects/dftd4/badge/?version=latest"></a>
<a href="https://dftd4.github.io/dftd4/"><img alt="docs" src="https://github.com/dftd4/dftd4/workflows/docs/badge.svg"></a>
<a href="https://codecov.io/gh/dftd4/dftd4"><img alt="codecov" src="https://codecov.io/gh/dftd4/dftd4/branch/main/graph/badge.svg?token=IFtEF1Hwqj"></a></p>
<p>Generally Applicable Atomic-Charge Dependent London Dispersion Correction.</p>
<h2 id="installing">Installing</h2>
<p>A statically linked binary distribution for Linux platforms is available at the <a href="https://github.com/dftd4/dftd4/releases/latest">latest release</a> tag.</p>
<h3 id="conda-package">Conda package</h3>
<p><a href="https://anaconda.org/conda-forge/dftd4"><img alt="Conda Version" src="https://img.shields.io/conda/vn/conda-forge/dftd4.svg?label=dftd4"></a>
<a href="https://anaconda.org/conda-forge/dftd4-python"><img alt="Conda Version" src="https://img.shields.io/conda/vn/conda-forge/dftd4-python.svg?label=dftd4-python"></a></p>
<p>This project is packaged for the <em>conda</em> package manager and available on the <em>conda-forge</em> channel.
To install the <em>conda</em> package manager we recommend the <a href="https://github.com/conda-forge/miniforge/releases">miniforge</a> installer.
If the <em>conda-forge</em> channel is not yet enabled, add it to your channels with</p>
<div class="codehilite"><pre><span></span><code>conda config --add channels conda-forge
</code></pre></div>

<p>Once the <em>conda-forge</em> channel has been enabled, this project can be installed with:</p>
<div class="codehilite"><pre><span></span><code>conda install dftd4
</code></pre></div>

<p>If you want to enable the Python API as well install</p>
<div class="codehilite"><pre><span></span><code>conda install dftd4-python
</code></pre></div>

<p>It is possible to list all of the versions available on your platform with:</p>
<div class="codehilite"><pre><span></span><code>conda search dftd4 --channel conda-forge
</code></pre></div>

<p>Now you are ready to use <code>dftd4</code>.</p>
<h3 id="spack-package">Spack package</h3>
<p><a href="https://packages.spack.io/package.html?name=dftd4"><img alt="Spack" src="https://img.shields.io/spack/v/dftd4"></a></p>
<p>This project is available with <a href="https://spack.io">spack</a> in its develop version.
You can install and load <code>dftd4</code> with</p>
<div class="codehilite"><pre><span></span><code><span class="n">spack</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">dftd4</span>
<span class="n">spack</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">dftd4</span>
</code></pre></div>

<p>The Python API can be enabled by adding <code>+python</code> to the command.</p>
<h3 id="freebsd-port">FreeBSD Port</h3>
<p><a href="https://www.freshports.org/science/dftd4/"><img alt="FreeBSD port" src="https://repology.org/badge/version-for-repo/freebsd/dftd4.svg"></a></p>
<p>A port for FreeBSD is available and can be installed using</p>
<div class="codehilite"><pre><span></span><code>pkg install science/dftd4
</code></pre></div>

<p>In case no package is available build the port using</p>
<div class="codehilite"><pre><span></span><code>cd /usr/ports/science/dftd4
make install clean
</code></pre></div>

<p>For more information see the <a href="https://www.freshports.org/science/dftd4/">dftd4 port details</a>.</p>
<h3 id="building-from-source">Building from Source</h3>
<p>To build this project from the source code in this repository you need to have
a Fortran compiler supporting Fortran 2008 and one of the supported build systems:
- <a href="https://mesonbuild.com">meson</a> version 0.55 or newer, with
  a build-system backend, <em>i.e.</em> <a href="https://ninja-build.org">ninja</a> version 1.7 or newer
- <a href="https://cmake.org">cmake</a> version 3.14 or newer, with
  a build-system backend, <em>i.e.</em> <a href="https://ninja-build.org">ninja</a> version 1.10 or newer
- <a href="https://github.com/fortran-lang/fpm">fpm</a> version 0.2.0 or newer</p>
<p>Currently this project supports GCC and Intel compilers.</p>
<details>
<summary>Problematic Versions</summary>

GCC versions 15.0.x - 15.1.x contain a [compiler bug](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=119928) leading to "Interface mismatch" errors during compilation.

</details>

<h4 id="building-with-meson">Building with meson</h4>
<p>To compile this version of DFT-D4 with meson the following programs are needed
(the number in parentheses specifies the tested versions).</p>
<p>To build this project from the source code in this repository you need to have
- a Fortran compiler supporting Fortran 2008
- <a href="https://mesonbuild.com">meson</a> version 0.55 or newer
- a build-system backend, <em>i.e.</em> <a href="https://ninja-build.org">ninja</a> version 1.7 or newer
- a LAPACK / BLAS provider, like MKL or OpenBLAS</p>
<p>Optional dependencies are
- asciidoctor to build the manual page
- FORD to build the developer documentation
- C compiler to test the C-API and compile the Python extension module
- Python 3.6 or newer with the CFFI package installed to build the Python API</p>
<p>Setup a build with</p>
<div class="codehilite"><pre><span></span><code>meson<span class="w"> </span>setup<span class="w"> </span>_build
</code></pre></div>

<p>You can select the Fortran compiler by the <code>FC</code> environment variable.
To compile and run the projects testsuite use</p>
<div class="codehilite"><pre><span></span><code>meson<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-C<span class="w"> </span>_build<span class="w"> </span>--print-errorlogs
</code></pre></div>

<p>If the testsuite passes you can install with</p>
<div class="codehilite"><pre><span></span><code>meson<span class="w"> </span>configure<span class="w"> </span>_build<span class="w"> </span>--prefix<span class="o">=</span>/path/to/install
meson<span class="w"> </span>install<span class="w"> </span>-C<span class="w"> </span>_build
</code></pre></div>

<p>This might require administrator access depending on the chosen install prefix.</p>
<h4 id="building-with-cmake">Building with CMake</h4>
<p>Alternatively, this project can be build with CMake (in this case ninja 1.10 or newer is required):</p>
<div class="codehilite"><pre><span></span><code>cmake -B _build -G Ninja -DCMAKE_INSTALL_PREFIX=$HOME/.local
</code></pre></div>

<p>To compile the project with CMake run</p>
<div class="codehilite"><pre><span></span><code>cmake --build _build
</code></pre></div>

<p>You can run the project testsuite with</p>
<div class="codehilite"><pre><span></span><code>ctest --test-dir _build --parallel --output-on-failure
</code></pre></div>

<p>Finally, you can install the project to the selected prefix</p>
<div class="codehilite"><pre><span></span><code>cmake --install _build
</code></pre></div>

<p>Note that the CMake build does not support to build the Python extension module as part of the main build.</p>
<h4 id="building-with-fpm">Building with fpm</h4>
<p>This project support the Fortran package manager (fpm).
Invoke fpm in the project root with</p>
<div class="codehilite"><pre><span></span><code>fpm build
</code></pre></div>

<p>To run the testsuite use</p>
<div class="codehilite"><pre><span></span><code>fpm test
</code></pre></div>

<p>You can access the <code>dftd4</code> program using the run subcommand</p>
<div class="codehilite"><pre><span></span><code>fpm run -- --help
</code></pre></div>

<p>To use <code>dftd4</code> for testing include it as dependency in your package manifest</p>
<div class="codehilite"><pre><span></span><code><span class="k">[dependencies]</span>
<span class="n">dftd4</span><span class="p">.</span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://github.com/dftd4/dftd4&quot;</span>
</code></pre></div>

<p>Note that the fpm build does not support exporting the C-API, it only provides access to the standalone binary.</p>
<h2 id="usage">Usage</h2>
<p>DFT-D4 calculations can be performed with the <code>dftd4</code> executable.
To calculate the dispersion correction for PBE0-D4 run:</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>--func<span class="w"> </span>pbe0<span class="w"> </span>coord
</code></pre></div>

<p>In case you want to access the DFT-D4 results from other programs, dump the results to JSON with
(the <code>--noedisp</code> flag prevents the <code>.EDISP</code> file generation):</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>--func<span class="w"> </span>pbe0<span class="w"> </span>--json<span class="w"> </span>--grad<span class="w"> </span>--noedisp<span class="w"> </span>struct.xyz
</code></pre></div>

<p>Dispersion related properties can be calculated as well:</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>--property<span class="w"> </span>geo.gen
</code></pre></div>

<p>To evaluate pairwise resolved dispersion energies use</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>--pair-resolved<span class="w"> </span>mol.xyz
</code></pre></div>

<p>For an overview over all command line arguments use the <code>--help</code> argument or checkout the <a href="https://github.com/dftd4/dftd4/blob/main/man/dftd4.1.adoc"><code>dftd4(1)</code></a> manpage.</p>
<h3 id="parallelism">Parallelism</h3>
<p>DFT-D4 calculations can be performed with shared-memory parallelism (OpenMP).</p>
<p>The number of parallel threads can be set through environment variables.</p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">4</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MKL_NUM_THREADS</span><span class="o">=</span><span class="m">4</span><span class="w">  </span><span class="c1"># Intel</span>
</code></pre></div>

<p>For large calculations, additional speed-ups might be possible by enabling dynamic scheduling in OMP by setting <code>OMP_SCHEDULE=dynamic</code>.
This might help particularly for versions &lt;4.0.0 (<a href="https://github.com/dftd4/dftd4/pull/319">explanation</a>).</p>
<p>Note that DFT-D4 is not MPI parallelized, and there are currently no plans to implement MPI parallelism.</p>
<h2 id="parameters">Parameters</h2>
<p>DFT-D4 is parametrized for plenty of density functionals.
The available parameters are listed in the <a href="https://github.com/dftd4/dftd4/blob/main/assets/parameters.toml">parameters.toml file</a> or with the following command.</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>param<span class="w"> </span>--list
</code></pre></div>

<p>While the functionals can be selected with their common names (e.g., <code>PBE</code>), the <a href="https://www.tddft.org/programs/libxc/functionals/">libxc</a> names can also be used (e.g., <code>GGA_X_PBE:GGA_C_PBE</code>).</p>
<div class="codehilite"><pre><span></span><code>dftd4<span class="w"> </span>--func<span class="w"> </span>PBE<span class="w"> </span>coord
dftd4<span class="w"> </span>--func<span class="w"> </span>GGA_X_PBE:GGA_C_PBE<span class="w"> </span>coord
</code></pre></div>

<p>The exchange and correlation functional must be separated by a colon.
All names are case-insensitive.</p>
<details>
<summary>Note on ωB97X-type functionals</summary>

Since there has been some confusion concerning the different ωB97X functionals, we provide a detailed summary: 

- [ωB97X](https://doi.org/10.1063/1.2834918) (original functional, 2008, parameters: `wb97x-2008`)
- [ωB97X-D](https://doi.org/10.1039/B810189B) (re-optimization of ωB97X to include dispersion correction, 2008, no D4 parameters)
- [ωB97X-D3](https://doi.org/10.1021/ct300715s) (re-optimization of ωB97X-D with improved dispersion corrections, D3(0), 2013, no D4 parameters)
- [ωB97X-V](https://doi.org/10.1039/C3CP54374A) (new functional, different from the above ωB97X's and not just a re-optimization for VV10 dispersion, 2013)
- [ωB97X-D4](https://doi.org/10.1002/jcc.26411) (ωB97X-V with D4 dispersion instead of VV10 dispersion, parameters: `wb97x`)
- [ωB97X-D4rev](https://doi.org/10.1063/5.0133026) (revised D4 parameters for ωB97X-V with D4 dispersion instead of VV10 dispersion, parameters: `wb97x-rev`)
- [ωB97X-3c](https://doi.org/10.1063/5.0133026) (Composite "3c" method based on ωB97X-V, parameters: `wb97x-3c`)

Note that the ωB97X parameters (`wb97x-2008`) cannot be used for the ωB97X-V functional (`wb97x`, `wb97x-rev`).

We recommend the revised D4 parameters for ωB97X-V (`wb97x-rev`).

</details>

<p><br></p>
<p>You can add new functionals using to the TOML file by adding a new subtable</p>
<div class="codehilite"><pre><span></span><code><span class="k">[parameter.name]</span>
<span class="n">reference</span><span class="p">.</span><span class="n">doi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;&lt;functional reference&gt;&quot;</span><span class="p">]</span>
<span class="n">d4</span><span class="p">.</span><span class="n">bj-eeq-atm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s8</span><span class="p">=</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">a1</span><span class="p">=</span><span class="mf">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">=</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="n">doi</span><span class="p">=</span><span class="s2">&quot;&lt;parameter reference&gt;&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>

<p>Those parameters are currently only used as reference and not yet usable in the library or executable.</p>
<h2 id="api-access">API access</h2>
<p>The DFT-D4 project provides first class API support Fortran, C and Python.
Other programming languages should try to interface with to DFT-D4 via one of those three APIs.
To provide first class API support for a new language the interface specification should be available as meson build files.</p>
<p>The <code>dftd4</code> binary provides with the <code>--json</code> option access to all quantities available from the APIs as well.</p>
<h3 id="fortran-api">Fortran API</h3>
<p>The recommended way to access the Fortran module API is by using <code>dftd4</code> as a meson subproject.
Alternatively, the project is accessible by the Fortran package manager (<a href="https://github.com/fortran-lang/fpm">fpm</a>).</p>
<p>The complete API is available from <code>dftd4</code> module, the individual modules are available to the user as well but are not part of the public API and therefore not guaranteed to remain stable.
ABI compatibility is only guaranteed for the same minor version.</p>
<p>The communication with the Fortran API uses the <code>error_type</code> and <code>structure_type</code> of the modular computation tool chain library (mctc-lib) to handle errors and represent geometries, respectively.</p>
<h4 id="building-vasp-with-support-for-d4">Building Vasp with support for D4</h4>
<p>To use <code>dftd4</code> in Vasp the compatibility layer for the 2.5.x API has to be enable with <code>-Dapi_v2=true</code> (meson) or <code>-DWITH_API_V2=ON</code> (CMake).
It is important to build <code>dftd4</code> with the same Fortran compiler you build Vasp with.</p>
<p>After you completed the installation of <code>dftd4</code>, make sure it is findable by <code>pkg-config</code>, you can check by running:</p>
<div class="codehilite"><pre><span></span><code>pkg-config --modversion dftd4
</code></pre></div>

<p>If your <code>dftd4</code> installation is not findable, you have to update your environment variables.
One option is to provide a module file for your <code>dftd4</code> installation.
The example module file below can be placed in your <code>MODULEPATH</code> to provide access to an installation in <code>~/opt/dftd4/4.0.2</code>.
Retry the above comment after loading the <code>dftd4</code> module and adjust the module file until <code>pkg-config</code> finds your installation.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- dftd4/4.0.2.lua</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;dftd4&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;4.0.2&quot;</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nb">os.getenv</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;opt&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">name</span><span class="p">,</span><span class="w"> </span><span class="nv">version</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">libdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;lib&quot;</span><span class="w">  </span><span class="c1">-- or lib64</span>

<span class="nf">whatis</span><span class="p">(</span><span class="s2">&quot;Name        : &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">name</span><span class="p">)</span>
<span class="nf">whatis</span><span class="p">(</span><span class="s2">&quot;Version     : &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">version</span><span class="p">)</span>
<span class="nf">whatis</span><span class="p">(</span><span class="s2">&quot;Description : Generally applicable charge dependent London dispersion correction&quot;</span><span class="p">)</span>
<span class="nf">whatis</span><span class="p">(</span><span class="s2">&quot;URL         : https://github.com/dftd4/dftd4&quot;</span><span class="p">)</span>

<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bin&quot;</span><span class="p">))</span>
<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;MANPATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;share&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;man&quot;</span><span class="p">))</span>
<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;CPATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;include&quot;</span><span class="p">))</span>
<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;LIBRARY_PATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="nv">libdir</span><span class="p">))</span>
<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="nv">libdir</span><span class="p">))</span>
<span class="nf">prepend_path</span><span class="p">(</span><span class="s2">&quot;PKG_CONFIG_PATH&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">pathJoin</span><span class="p">(</span><span class="nv">prefix</span><span class="p">,</span><span class="w"> </span><span class="nv">libdir</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pkgconfig&quot;</span><span class="p">))</span>
</code></pre></div>

<p>To enable support for D4 in Vasp add the following lines to the Makefile:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">CPP_OPTIONS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-DDFTD4
<span class="nv">LLIBS</span><span class="w">       </span><span class="o">+=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>dftd4<span class="k">)</span>
<span class="nv">INCS</span><span class="w">        </span><span class="o">+=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span>pkg-config<span class="w"> </span>--cflags<span class="w"> </span>dftd4<span class="k">)</span>
</code></pre></div>

<p>Depending on how you built DFT-D4, DFT-D4&rsquo;s dependencies might not be properly recognized during the VASP build. Try to explicitly add them to the link line.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">CPP_OPTIONS</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span>-DDFTD4
<span class="nv">LLIBS</span><span class="w">       </span><span class="o">+=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>dftd4<span class="k">)</span><span class="w"> </span>-lmulticharge<span class="w"> </span>-lmctc-lib<span class="w"> </span>-lmstore
<span class="nv">INCS</span><span class="w">        </span><span class="o">+=</span><span class="w"> </span><span class="k">$(</span>shell<span class="w"> </span>pkg-config<span class="w"> </span>--cflags<span class="w"> </span>dftd4<span class="k">)</span>
</code></pre></div>

<p>If you still run into issues, check out <a href="https://github.com/dftd4/dftd4/issues?q=label%3Avasp%20">VASP-related issues</a> on the <code>dftd4</code> issue tracker.</p>
<h3 id="c-api">C API</h3>
<p>The C API provides access to the basic Fortran objects and their most important methods to interact with them.
All Fortran objects are available as opaque <code>void*</code> in C and can only be manipulated with the correct API calls.
To evaluate a dispersion correction in C four objects are available:</p>
<ol>
<li>the error handler:</li>
</ol>
<p>Simple error handler to carry runtime exceptions created by the library.
   Exceptions can be handled and/or transfered to the downstream error handling system by this means.</p>
<ol>
<li>the molecular structure data:</li>
</ol>
<p>Provides a representation of the molecular structure with immutable number of atoms, atomic species, total charge and boundary conditions.
   The object provides a way to update coordinates and lattice parameters, to update immutable quantities the object has to be recreated.</p>
<ol>
<li>the dispersion model:</li>
</ol>
<p>Instantiated for a given molecular structure type, it carries no information on the geometry but relies on the atomic species of the structure object.
   Recreating a structure object requires to recreate the dispersion model as well.</p>
<ol>
<li>the damping parameters:</li>
</ol>
<p>Damping parameter object determining the short-range behaviour of the dispersion correction.
   Standard damping parameters like the rational damping are independent of the molecular structure and can easily be reused for several structures or easily exchanged.</p>
<p>The user is responsible for creating and deleting the objects to avoid memory leaks.
For convenience the type-generic macro <code>dftd4_delete</code> is available to free any memory allocation made in the library.</p>
<h3 id="python-api">Python API</h3>
<p>The Python API is disabled by default and can be built in-tree or out-of-tree.
The in-tree build is mainly meant for end users and packages.
To build the Python API with the normal project set the <code>python</code> option in the configuration step with</p>
<div class="codehilite"><pre><span></span><code>meson<span class="w"> </span>setup<span class="w"> </span>_build<span class="w"> </span>-Dpython<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-Dpython_version<span class="o">=</span><span class="k">$(</span>which<span class="w"> </span>python3<span class="k">)</span>
</code></pre></div>

<p>The Python version can be used to select a different Python version, it defaults to <code>'python3'</code>.
Python 2 is not supported with this project, the Python version key is meant to select between several local Python 3 versions.</p>
<p>Proceed with the build as described before and install the projects to make the Python API available in the selected prefix.</p>
<p>For the out-of-tree build see the instructions in the <a href="https://github.com/dftd4/dftd4/blob/main/python"><code>python</code></a> directory.</p>
<h2 id="citation">Citation</h2>
<p>Always cite:</p>
<p>Eike Caldeweyher, Christoph Bannwarth and Stefan Grimme, <em>J. Chem. Phys.</em>, <strong>2017</strong>, 147, 034112.
DOI: <a href="https://doi.org/10.1063/1.4993215">10.1063/1.4993215</a></p>
<p>Eike Caldeweyher, Sebastian Ehlert, Andreas Hansen, Hagen Neugebauer, Sebastian Spicher, Christoph Bannwarth and Stefan Grimme, <em>J. Chem Phys</em>, <strong>2019</strong>, 150, 154122.
DOI: <a href="https://doi.org/10.1063/1.5090222">10.1063/1.5090222</a>
chemrxiv: <a href="https://doi.org/10.26434/chemrxiv.7430216.v2">10.26434/chemrxiv.7430216</a></p>
<p>Eike Caldeweyher, Jan-Michael Mewes, Sebastian Ehlert and Stefan Grimme, <em>Phys. Chem. Chem. Phys.</em>, <strong>2020</strong>, 22, 8499-8512.
DOI: <a href="https://doi.org/10.1039/D0CP00502A">10.1039/D0CP00502A</a>
chemrxiv: <a href="https://doi.org/10.26434/chemrxiv.10299428.v1">10.26434/chemrxiv.10299428</a></p>
<p><br></p>
<p>In the range-separate hybrid context:</p>
<p>Marvin Friede, Sebastian Ehlert, Stefan Grimme and Jan-Michael Mewes, <em>J. Chem. Theory Comput.</em>, <strong>2023</strong>, 19 (22), 8097-8107.
DOI: <a href="10.1021/acs.jctc.3c00717">10.1021/acs.jctc.3c00717</a></p>
<p><br></p>
<p>Extension to Fr, Ra, and full Actinide series:</p>
<p>Lukas Wittmann, Igor Gordiy, Marvin Friede, Benjamin Helmich-Paris, Stefan Grimme, Andreas Hansen and Markus Bursch, <em>Phys. Chem. Chem. Phys.</em>, <strong>2024</strong>, 26, 21379-21394.
DOI: <a href="10.1039/D4CP01514B">10.1039/D4CP01514B</a></p>
<p><br></p>
<p>Citations can also be viewed via <code>dftd4 --citation</code> or in the <a href="CITATION.bib">BibTeX file</a>.</p>
<h2 id="license">License</h2>
<p>This project is free software: you can redistribute it and/or modify it under
the terms of the Lesser GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>This project is distributed in the hope that it will be useful,
but without any warranty; without even the implied warranty of
merchantability or fitness for a particular purpose.  See the
Lesser GNU General Public License for more details.</p>
<p>Unless you explicitly state otherwise, any contribution intentionally
submitted for inclusion in this project by you, as defined in the
Lesser GNU General Public license, shall be licensed as above, without any
additional terms or conditions.</p>
        </div>
          <div class="col-md-4">
            <div class="card card-body bg-light">
              <h2 class="card-title">Developer Info</h2>
              <h4 class="card-text">Grimme group Bonn</h4>
              <p class="card-text"></p>
                <div class="text-center"><div class="btn-group" role="group">
                    <a class="btn btn-lg btn-primary" href="https://mctc.uni-bonn.de/software/dftd4"><i class="fa fa-globe fa-lg"></i></a>
                    <a class="btn btn-lg btn-primary" href="https://github.com/dftd4"><i class="fa fa-github fa-lg"></i></a>
                    
                    
                    
                    
                    
                    
                </div></div>
            </div>
          </div>
      </div>
        <div class="row">
          <hr>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Source Files</h3>
              <ul><li><a href='sourcefile/api.f90.html'>api.f90</a></li><li><a href='sourcefile/atm.f90.html'>atm.f90</a></li><li><a href='sourcefile/blas.f90.html'>blas.F90</a></li><li><a href='sourcefile/compat.f90.html'>compat.f90</a></li><li><a href='sourcefile/covrad.f90.html'>covrad.f90</a></li><li><a href='sourcefile/cutoff.f90.html'>cutoff.f90</a></li><li><a href='sourcefile/d4.f90.html'>d4.f90</a></li><li><a href='sourcefile/d4s.f90.html'>d4s.f90</a></li><li><a href='sourcefile/damping.f90.html'>damping.f90</a></li><li><a href='sourcefile/data.f90.html'>data.f90</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/files.html"><em>All source files&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Modules</h3>
              <ul><li><a href='module/class_molecule.html'>class_molecule</a></li><li><a href='module/class_param.html'>class_param</a></li><li><a href='module/class_results.html'>class_results</a></li><li><a href='module/class_set.html'>class_set</a></li><li><a href='module/class_wsc.html'>class_wsc</a></li><li><a href='module/dftd4.html'>dftd4</a></li><li><a href='module/dftd4_api.html'>dftd4_api</a></li><li><a href='module/dftd4_blas.html'>dftd4_blas</a></li><li><a href='module/dftd4_compat.html'>dftd4_compat</a></li><li><a href='module/dftd4_cutoff.html'>dftd4_cutoff</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/modules.html"><em>All modules&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Procedures</h3>
              <ul><li><a href='proc/add_coordination_number_derivs.html'>add_coordination_number_derivs</a></li><li><a href='proc/allocate.html'>allocate</a></li><li><a href='proc/ascii_atomic_radii.html'>ascii_atomic_radii</a></li><li><a href='proc/ascii_atomic_references.html'>ascii_atomic_references</a></li><li><a href='proc/ascii_damping_param.html'>ascii_damping_param</a></li><li><a href='proc/ascii_pairwise.html'>ascii_pairwise</a></li><li><a href='proc/ascii_results.html'>ascii_results</a></li><li><a href='proc/ascii_system_properties.html'>ascii_system_properties</a></li><li><a href='interface/blas_gemv.html'>blas_gemv</a></li><li><a href='proc/c_f_character.html'>c_f_character</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/procedures.html"><em>All procedures&hellip;</em></a></li>
              </ul>
            </div>
          </div>
          <div class="col-xs-6 col-sm-3">
            <div>
              <h3>Derived Types</h3>
              <ul><li><a href='type/d4_model.html'>d4_model</a></li><li><a href='type/d4s_model.html'>d4s_model</a></li><li><a href='type/damping_param.html'>damping_param</a></li><li><a href='type/dftd_options.html'>dftd_options</a></li><li><a href='type/dftd_parameter.html'>dftd_parameter</a></li><li><a href='type/dftd_results.html'>dftd_results</a></li><li><a href='type/dispersion_model.html'>dispersion_model</a></li><li><a href='type/enum_qmod.html'>enum_qmod</a></li><li><a href='type/functional_group.html'>functional_group</a></li><li><a href='type/mctc_logger.html'>mctc_logger</a></li></ul>
            </div>
            <div>
              <ul>
                <li><a href="./lists/types.html"><em>All derived types&hellip;</em></a></li>
              </ul>
            </div>
          </div>
        </div>
      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              DFT-D4
 was developed by Grimme group Bonn<br>              &copy; 2026 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2026-02-14 16:11 +0000             </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>
  </body>
</html>